<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvestFlow Pro | Â∞àÊ•≠ÂàáÊèõÁâà</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#020617',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { transition: background-color 0.3s ease, color 0.3s ease; }
        .transition-all-300 { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .input-field:focus { outline: none; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* ÈñãÈóúÂãïÁï´ */
        .toggle-checkbox:checked { right: 0; border-color: #68D391; }
        .toggle-checkbox:checked + .toggle-label { background-color: #68D391; }
    </style>
</head>
<body class="bg-slate-100 text-slate-900 dark:bg-slate-950 dark:text-slate-100 transition-all-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const RechartsLib = window.Recharts || {};
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend, AreaChart, Area } = RechartsLib;

        const SUPABASE_URL = 'https://quugdrntvrmlndqgoshk.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF1dWdkcm50dnJtbG5kcWdvc2hrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczMjkyMTksImV4cCI6MjA4MjkwNTIxOX0.WMMa-iju0V8JwY89EK0lAelNIBtw02OwcCVE2W5k6yM';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('home');
            const [isDrawerOpen, setIsDrawerOpen] = useState(false);
            const [records, setRecords] = useState([]);
            const [initCap, setInitCap] = useState(0);
            const [filterRange, setFilterRange] = useState({ start: '', end: '' });

            // --- Êó•Â§úÊ®°Âºè ---
            const [isDarkMode, setIsDarkMode] = useState(() => {
                const savedTheme = localStorage.getItem('investflow_theme');
                if (savedTheme) return savedTheme === 'dark';
                return window.matchMedia('(prefers-color-scheme: dark)').matches;
            });

            useEffect(() => {
                const html = document.documentElement;
                if (isDarkMode) {
                    html.classList.add('dark');
                    localStorage.setItem('investflow_theme', 'dark');
                } else {
                    html.classList.remove('dark');
                    localStorage.setItem('investflow_theme', 'light');
                }
            }, [isDarkMode]);
            
            const [assets, setAssets] = useState(() => {
                const saved = localStorage.getItem('investflow_assets');
                return saved ? JSON.parse(saved) : [
                    { id: 1, name: 'Binance (Âπ£ÂÆâ)', amount: '' },
                    { id: 2, name: 'OKX (Ê≠êÊòì)', amount: '' },
                    { id: 3, name: 'Cold Wallet (ÂÜ∑Èå¢ÂåÖ)', amount: '' }
                ];
            });

            const [authForm, setAuthForm] = useState({ email: '', password: '' });
            const [mainForm, setMainForm] = useState({ amount: '', deposit: '', withdrawal: '', note: '', date: new Date().toISOString().slice(0, 16) });
            const [editingId, setEditingId] = useState(null);
            const [editForm, setEditForm] = useState({});

            useEffect(() => {
                localStorage.setItem('investflow_assets', JSON.stringify(assets));
            }, [assets]);

            useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setUser(session?.user ?? null);
                    if (session?.user) fetchUserSettings(session.user.id);
                });
                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    setUser(session?.user ?? null);
                    if (session?.user) fetchUserSettings(session.user.id);
                });
                return () => subscription.unsubscribe();
            }, []);

            useEffect(() => { if (user) fetchData(); }, [user]);

            const fetchUserSettings = async (userId) => {
                const { data } = await supabase.from('user_settings').select('invest_init').eq('user_id', userId).single();
                if (data) setInitCap(data.invest_init);
            };

            const fetchData = async () => {
                const { data } = await supabase.from('records').select('*').order('date', { ascending: true });
                if (data) setRecords(data);
            };

            const handleAuth = async (e) => {
                e.preventDefault();
                const { data: signInData, error: signInError } = await supabase.auth.signInWithPassword({ email: authForm.email, password: authForm.password });
                if (signInError) {
                    const { error: signUpError } = await supabase.auth.signUp({ email: authForm.email, password: authForm.password });
                    if (signUpError) alert("È©óË≠âÂ§±Êïó: " + signUpError.message);
                    else alert("Ë®ªÂÜäÊàêÂäüÔºåË´ãÂòóË©¶ÁôªÂÖ•");
                }
            };

            const syncInitCap = async (val) => {
                const numVal = parseFloat(val) || 0;
                setInitCap(numVal);
                if (user) await supabase.from('user_settings').upsert({ user_id: user.id, invest_init: numVal, updated_at: new Date().toISOString() });
            };

            const updateAsset = (id, field, value) => {
                setAssets(assets.map(a => a.id === id ? { ...a, [field]: value } : a));
            };

            const addAssetRow = () => {
                setAssets([...assets, { id: Date.now(), name: '', amount: '' }]);
            };

            const removeAssetRow = (id) => {
                if(assets.length > 1) {
                    setAssets(assets.filter(a => a.id !== id));
                } else {
                    setAssets([{ id: Date.now(), name: '', amount: '' }]);
                }
            };

            const totalAssets = useMemo(() => {
                return assets.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0);
            }, [assets]);

            const handleSyncToLedger = async () => {
                if (totalAssets <= 0) return alert("Á∏ΩÈáëÈ°çÁÇ∫ 0ÔºåË´ãÂÖàËº∏ÂÖ•Ë≥áÁî¢ÈáëÈ°ç„ÄÇ");
                if (!confirm(`Á¢∫ÂÆöË¶ÅÂ∞áÁ∏ΩÈáëÈ°ç $${totalAssets.toLocaleString()} ÂØ´ÂÖ•Â∏≥Êú¨ÂóéÔºü`)) return;

                const { error } = await supabase.from('records').insert([{
                    user_id: user.id,
                    date: new Date().toISOString(),
                    amount: parseFloat(totalAssets),
                    deposit: 0,
                    withdrawal: 0,
                    note: '‰æÜËá™Ë≥áÁî¢Ê∏ÖÂñÆÂêåÊ≠•'
                }]);

                if (!error) {
                    alert('‚úÖ Â∑≤ÊàêÂäüÂØ´ÂÖ•Â∏≥Êú¨ÔºÅ');
                    fetchData();
                } else {
                    alert('ÂØ´ÂÖ•Â§±Êïó: ' + error.message);
                }
            };

            const handleAdd = async (e) => {
                e.preventDefault();
                const { error } = await supabase.from('records').insert([{
                    user_id: user.id, date: new Date(mainForm.date).toISOString(),
                    amount: parseFloat(mainForm.amount), deposit: parseFloat(mainForm.deposit || 0),
                    withdrawal: parseFloat(mainForm.withdrawal || 0), note: mainForm.note
                }]);
                if (!error) { setMainForm({...mainForm, amount:'', deposit:'', withdrawal:'', note:''}); fetchData(); }
            };

            const handleUpdate = async (id) => {
                const { error } = await supabase.from('records').update({
                    amount: parseFloat(editForm.amount), deposit: parseFloat(editForm.deposit || 0),
                    withdrawal: parseFloat(editForm.withdrawal || 0), date: new Date(editForm.date).toISOString()
                }).eq('id', id);
                if (!error) { setEditingId(null); fetchData(); }
            };

            const allData = useMemo(() => {
                let cumulativeFlow = 0;
                return records.map((r, i) => {
                    cumulativeFlow += (parseFloat(r.deposit || 0) - parseFloat(r.withdrawal || 0));
                    const prev = records[i-1];
                    const profit = prev ? (r.amount - prev.amount - (r.deposit || 0) + (r.withdrawal || 0)) : 0;
                    const roi = (prev && prev.amount !== 0) ? (profit / prev.amount) * 100 : 0;
                    const dateObj = new Date(r.date);
                    return { 
                        ...r, ts: dateObj.getTime(),
                        displayDate: `${dateObj.getMonth() + 1}/${dateObj.getDate()}`,
                        displayDateTime: dateObj.toLocaleString([], {year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute:'2-digit'}),
                        'ÂØ¶Èöõ': r.amount, 'ÈÇÑÂéü': r.amount - cumulativeFlow, p: profit, r: roi 
                    };
                });
            }, [records]);

            const analysisData = useMemo(() => {
                if (!filterRange.start || !filterRange.end) return allData;
                const sTs = new Date(filterRange.start).setHours(0,0,0,0);
                const eTs = new Date(filterRange.end).setHours(23,59,59,999);
                return allData.filter(r => r.ts >= sTs && r.ts <= eTs);
            }, [allData, filterRange]);

            const analysisStats = useMemo(() => {
                if (analysisData.length < 1) return { profit: 0, roi: 0, totalDep: 0, totalWith: 0 };
                const totalDep = analysisData.reduce((sum, r) => sum + parseFloat(r.deposit || 0), 0);
                const totalWith = analysisData.reduce((sum, r) => sum + parseFloat(r.withdrawal || 0), 0);
                const first = analysisData[0];
                const last = analysisData[analysisData.length - 1];
                const rangeProfit = last['ÈÇÑÂéü'] - first['ÈÇÑÂéü'];
                const rangeROI = (first['ÂØ¶Èöõ'] !== 0) ? (rangeProfit / first['ÂØ¶Èöõ']) * 100 : 0;
                return { profit: rangeProfit, roi: rangeROI, totalDep, totalWith };
            }, [analysisData]);

            // ÂúñË°®È°èËâ≤ÈÖçÁΩÆ
            const chartColors = {
                grid: isDarkMode ? '#334155' : '#e2e8f0',
                text: isDarkMode ? '#94a3b8' : '#64748b',
                tooltipBg: isDarkMode ? '#1e293b' : '#fff',
                tooltipBorder: isDarkMode ? '#475569' : '#e2e8f0'
            };

            if (!user) return (
                <div className="flex items-center justify-center min-h-screen bg-slate-100 dark:bg-slate-950 p-6 transition-colors">
                    <div className="w-full max-w-md bg-white dark:bg-slate-900 p-10 rounded-xl shadow-lg border border-slate-200 dark:border-slate-800 transition-colors">
                        <div className="text-center mb-10">
                            <h1 className="text-3xl font-bold text-slate-800 dark:text-white tracking-tight">InvestFlow Pro</h1>
                            <p className="text-slate-500 dark:text-slate-400 mt-2 text-sm">Â∞àÊ•≠Ë≥áÁî¢ËøΩËπ§ËàáÁç≤Âà©ÂàÜÊûêÁ≥ªÁµ±</p>
                        </div>
                        <form onSubmit={handleAuth} className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">ÈõªÂ≠ê‰ø°ÁÆ±</label>
                                <input type="email" placeholder="name@company.com" value={authForm.email} onChange={e=>setAuthForm({...authForm, email:e.target.value})} className="input-field w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg text-slate-800 dark:text-white" required />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">ÂØÜÁ¢º</label>
                                <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={authForm.password} onChange={e=>setAuthForm({...authForm, password:e.target.value})} className="input-field w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg text-slate-800 dark:text-white" required />
                            </div>
                            <button className="w-full bg-slate-900 dark:bg-blue-600 hover:bg-slate-800 dark:hover:bg-blue-500 text-white font-medium py-3 rounded-lg shadow-md transition-all transform active:scale-95">ÁôªÂÖ•Á≥ªÁµ±</button>
                        </form>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen flex flex-col md:flex-row transition-colors bg-slate-100 dark:bg-slate-950">
                    {/* --- ÂÅ¥ÈÇäÈÅ∏ÂñÆ --- */}
                    <aside className={`fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 transform transition-transform duration-300 md:relative md:translate-x-0 ${isDrawerOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                        <div className="p-6 h-full flex flex-col justify-between">
                            {/* ‰∏äÂçäÈÉ®ÔºöLogo ËàáÂ∞éËà™ */}
                            <div>
                                <div className="flex items-center gap-3 mb-10">
                                    <div className="w-8 h-8 bg-slate-900 dark:bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">IF</div>
                                    <h1 className="text-xl font-bold text-slate-800 dark:text-white">InvestFlow</h1>
                                </div>
                                <nav className="space-y-2">
                                    <button onClick={()=>{setActiveTab('home'); setIsDrawerOpen(false)}} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${activeTab === 'home' ? 'bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white border border-slate-200 dark:border-slate-700' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white'}`}>
                                        <span>üìä</span> Â∏≥Êú¨Á∏ΩË¶Ω
                                    </button>
                                    <button onClick={()=>{setActiveTab('assets'); setIsDrawerOpen(false)}} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${activeTab === 'assets' ? 'bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white border border-slate-200 dark:border-slate-700' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white'}`}>
                                        <span>üí∞</span> Ë≥áÁî¢ÁÆ°ÁêÜ
                                    </button>
                                    <button onClick={()=>{setActiveTab('analysis'); setIsDrawerOpen(false)}} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${activeTab === 'analysis' ? 'bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white border border-slate-200 dark:border-slate-700' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white'}`}>
                                        <span>üìà</span> Áç≤Âà©ÂàÜÊûê
                                    </button>
                                </nav>
                            </div>

                            {/* ‰∏ãÂçäÈÉ®ÔºöÂ§ñËßÄË®≠ÂÆöËàáÁôªÂá∫ (ÁΩÆÊñºÂ∑¶‰∏ãËßí) */}
                            <div className="space-y-6 pt-6 border-t border-slate-100 dark:border-slate-800">
                                
                                {/* ‚òÄÔ∏è/üåô ‰ªãÈù¢È¢®Ê†ºÂàáÊèõÈñãÈóú */}
                                <div className="px-2">
                                    <div className="flex items-center justify-between mb-2">
                                        <span className="text-xs font-bold text-slate-400 uppercase tracking-wider">‰ªãÈù¢È¢®Ê†º</span>
                                    </div>
                                    <button 
                                        onClick={() => setIsDarkMode(!isDarkMode)}
                                        className={`relative w-full h-10 rounded-full transition-colors duration-300 focus:outline-none border ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-slate-100 border-slate-200'}`}
                                    >
                                        {/* Â∫ïÂ±§ÂúñÁ§∫ (Âõ∫ÂÆö‰ΩçÁΩÆ) */}
                                        <div className="absolute inset-0 flex justify-between items-center px-4">
                                            <span className="text-sm opacity-80">‚òÄÔ∏è</span>
                                            <span className="text-sm opacity-80">üåô</span>
                                        </div>
                                        {/* ÊªëÂãïÂúìÈàï */}
                                        <div className={`absolute top-1 left-1 w-8 h-8 bg-white dark:bg-blue-500 rounded-full shadow-md transform transition-transform duration-300 flex items-center justify-center ${isDarkMode ? 'translate-x-[calc(100%+2.5rem)]' : 'translate-x-0'}`}>
                                            {/* ÂúìÈàïÂÖßÁöÑÂãïÊÖãÂúñÁ§∫ (ÂèØÈÅ∏) */}
                                            {isDarkMode ? 
                                                <svg className="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg> 
                                                : 
                                                <svg className="w-4 h-4 text-amber-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                                            }
                                        </div>
                                    </button>
                                </div>

                                <div>
                                    <div className="text-xs text-slate-400 mb-2 px-2 truncate">‰ΩøÁî®ËÄÖ: {user.email}</div>
                                    <button onClick={()=>supabase.auth.signOut()} className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors">
                                        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                                        ÁôªÂá∫Á≥ªÁµ±
                                    </button>
                                </div>
                            </div>
                        </div>
                    </aside>

                    {/* --- ÈÅÆÁΩ© (Mobile) --- */}
                    {isDrawerOpen && <div className="fixed inset-0 bg-slate-900/50 z-40 md:hidden backdrop-blur-sm" onClick={()=>setIsDrawerOpen(false)}></div>}

                    {/* --- ‰∏ªÂÖßÂÆπÂçÄ --- */}
                    <div className="flex-1 flex flex-col min-w-0 overflow-hidden">
                        <header className="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 h-16 flex items-center justify-between px-6 md:hidden sticky top-0 z-30 transition-colors">
                            <div className="flex items-center">
                                <button onClick={()=>setIsDrawerOpen(true)} className="p-2 -ml-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                </button>
                                <h1 className="ml-4 font-bold text-slate-800 dark:text-white">{activeTab === 'home' ? 'Â∏≥Êú¨Á∏ΩË¶Ω' : activeTab === 'assets' ? 'Ë≥áÁî¢ÁÆ°ÁêÜ' : 'Áç≤Âà©ÂàÜÊûê'}</h1>
                            </div>
                        </header>

                        <main className="flex-1 overflow-y-auto p-4 md:p-8">
                            <div className="max-w-5xl mx-auto space-y-6">
                                
                                {/* üè† Â∏≥Êú¨Á∏ΩË¶Ω */}
                                {activeTab === 'home' && (
                                    <div className="animate-in fade-in duration-300 space-y-6">
                                        {/* È†ÇÈÉ®ÂúñË°®Âç°Áâá */}
                                        <div className="bg-white dark:bg-slate-900 p-6 md:p-8 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm transition-colors">
                                            <div className="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4">
                                                <div>
                                                    <label className="block text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide mb-1">ÂàùÂßãÊäïÂÖ•Êú¨Èáë</label>
                                                    <div className="flex items-center border-b border-slate-300 dark:border-slate-700 focus-within:border-slate-800 dark:focus-within:border-white transition-colors pb-1">
                                                        <span className="text-lg text-slate-400 mr-1">$</span>
                                                        <input type="number" value={initCap} onChange={e => syncInitCap(e.target.value)} className="text-2xl font-bold text-slate-800 dark:text-white bg-transparent outline-none w-40 placeholder-slate-300" placeholder="0" />
                                                    </div>
                                                </div>
                                                <div className="text-left md:text-right">
                                                    <p className="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide mb-1">ÁõÆÂâçÊ∑®Áç≤Âà© / Â†±ÈÖ¨Áéá</p>
                                                    <div className={`text-2xl font-bold ${allData[allData.length-1]?.['ÈÇÑÂéü'] - initCap >= 0 ? 'text-emerald-600 dark:text-emerald-400' : 'text-rose-600 dark:text-rose-400'}`}>
                                                        ${Math.round(allData[allData.length-1]?.['ÈÇÑÂéü'] - initCap || 0).toLocaleString()} 
                                                        <span className="text-sm font-medium ml-2 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-md text-slate-600 dark:text-slate-300">
                                                            {(((allData[allData.length-1]?.['ÈÇÑÂéü'] - initCap) / (initCap || 1)) * 100).toFixed(2)}%
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="h-72 w-full">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    {LineChart ? (
                                                        <LineChart data={allData} margin={{top:10, right:10, left:-20, bottom:0}}>
                                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke={chartColors.grid} />
                                                            <XAxis dataKey="displayDate" axisLine={false} tickLine={false} tick={{fontSize:11, fill:chartColors.text}} minTickGap={40} tickMargin={10} />
                                                            <YAxis axisLine={false} tickLine={false} tick={{fontSize:11, fill:chartColors.text}} />
                                                            <Tooltip contentStyle={{backgroundColor:chartColors.tooltipBg, borderRadius:'8px', border:`1px solid ${chartColors.tooltipBorder}`, color: isDarkMode ? '#fff' : '#000', boxShadow:'0 4px 6px -1px rgba(0,0,0,0.1)'}} />
                                                            <Legend align="right" verticalAlign="top" iconType="circle" wrapperStyle={{paddingBottom:'20px', fontSize:'12px'}} />
                                                            <Line name="ÂØ¶ÈöõÈ§òÈ°ç" type="monotone" dataKey="ÂØ¶Èöõ" stroke="#3b82f6" strokeWidth={3} dot={false} activeDot={{r:6, strokeWidth:0}} />
                                                            <Line name="ÈÇÑÂéüÂ∏ÇÂÄº" type="monotone" dataKey="ÈÇÑÂéü" stroke="#f59e0b" strokeWidth={3} dot={false} activeDot={{r:6, strokeWidth:0}} />
                                                        </LineChart>
                                                    ) : null}
                                                </ResponsiveContainer>
                                            </div>
                                        </div>

                                        {/* Êñ∞Â¢ûÁ¥ÄÈåÑÂçÄÂ°ä */}
                                        <div className="bg-slate-900 dark:bg-slate-800 text-white p-6 md:p-8 rounded-xl shadow-lg transition-colors">
                                            <h3 className="text-sm font-semibold text-slate-400 uppercase tracking-wide mb-4">Êñ∞Â¢û‰∏ÄÁ≠ÜÁ¥ÄÈåÑ</h3>
                                            <form onSubmit={handleAdd} className="space-y-6">
                                                <div className="flex flex-col md:flex-row gap-6">
                                                    <div className="flex-1">
                                                        <label className="block text-xs text-slate-400 mb-1">Á¥ÄÈåÑÊôÇÈñì</label>
                                                        <input type="datetime-local" value={mainForm.date} onChange={e=>setMainForm({...mainForm, date:e.target.value})} className="w-full bg-slate-800 dark:bg-slate-700 border border-slate-700 dark:border-slate-600 text-white rounded-lg p-3 outline-none focus:border-blue-500" />
                                                    </div>
                                                    <div className="flex-1">
                                                        <label className="block text-xs text-slate-400 mb-1">‰ªäÊó•Á∏ΩË≥áÁî¢ (USD)</label>
                                                        <input type="number" step="0.01" value={mainForm.amount} onChange={e=>setMainForm({...mainForm, amount:e.target.value})} className="w-full bg-slate-800 dark:bg-slate-700 border border-slate-700 dark:border-slate-600 text-white text-lg font-bold rounded-lg p-3 outline-none focus:border-blue-500" placeholder="0.00" required />
                                                    </div>
                                                </div>
                                                <div className="flex gap-4">
                                                    <div className="flex-1">
                                                        <label className="block text-xs text-emerald-400 mb-1">ÂÖ•Èáë Deposit</label>
                                                        <input type="number" value={mainForm.deposit} onChange={e=>setMainForm({...mainForm, deposit:e.target.value})} className="w-full bg-slate-800 dark:bg-slate-700 border border-slate-700 dark:border-slate-600 text-white rounded-lg p-3 outline-none focus:border-emerald-500" placeholder="0" />
                                                    </div>
                                                    <div className="flex-1">
                                                        <label className="block text-xs text-rose-400 mb-1">Âá∫Èáë Withdraw</label>
                                                        <input type="number" value={mainForm.withdrawal} onChange={e=>setMainForm({...mainForm, withdrawal:e.target.value})} className="w-full bg-slate-800 dark:bg-slate-700 border border-slate-700 dark:border-slate-600 text-white rounded-lg p-3 outline-none focus:border-rose-500" placeholder="0" />
                                                    </div>
                                                </div>
                                                <button className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg shadow-md transition-transform transform active:scale-95">
                                                    Á¢∫Ë™çÂÑ≤Â≠ò
                                                </button>
                                            </form>
                                        </div>

                                        {/* Ê≠∑Âè≤Á¥ÄÈåÑÂàóË°® */}
                                        <div className="space-y-3">
                                            <h3 className="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wide px-1">ËøëÊúüÁ¥ÄÈåÑ</h3>
                                            {[...allData].reverse().map(r => (
                                                <div key={r.id} className="bg-white dark:bg-slate-900 p-5 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm hover:border-blue-300 dark:hover:border-blue-500 transition-colors cursor-pointer" onClick={()=>{setEditingId(r.id); setEditForm({amount:r.amount, deposit:r.deposit, withdrawal:r.withdrawal, note:r.note||'', date:new Date(r.date).toISOString().slice(0,16)});}}>
                                                    {editingId === r.id ? (
                                                        <div className="space-y-4" onClick={e=>e.stopPropagation()}>
                                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                                <div>
                                                                    <label className="block text-xs text-slate-500 dark:text-slate-400 mb-1">ÊôÇÈñì</label>
                                                                    <input type="datetime-local" value={editForm.date} onChange={e=>setEditForm({...editForm, date:e.target.value})} className="input-field w-full p-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-md text-sm text-slate-800 dark:text-white" />
                                                                </div>
                                                                <div>
                                                                    <label className="block text-xs text-slate-500 dark:text-slate-400 mb-1">È§òÈ°ç</label>
                                                                    <input type="number" value={editForm.amount} onChange={e=>setEditForm({...editForm, amount:e.target.value})} className="input-field w-full p-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-md text-sm font-bold text-blue-600 dark:text-blue-400" />
                                                                </div>
                                                                <div>
                                                                    <label className="block text-xs text-emerald-600 dark:text-emerald-400 mb-1">ÂÖ•Èáë</label>
                                                                    <input type="number" value={editForm.deposit} onChange={e=>setEditForm({...editForm, deposit:e.target.value})} className="input-field w-full p-2 bg-emerald-50 dark:bg-slate-800 border border-emerald-200 dark:border-emerald-900 rounded-md text-sm text-slate-800 dark:text-white" />
                                                                </div>
                                                                <div>
                                                                    <label className="block text-xs text-rose-600 dark:text-rose-400 mb-1">Âá∫Èáë</label>
                                                                    <input type="number" value={editForm.withdrawal} onChange={e=>setEditForm({...editForm, withdrawal:e.target.value})} className="input-field w-full p-2 bg-rose-50 dark:bg-slate-800 border border-rose-200 dark:border-rose-900 rounded-md text-sm text-slate-800 dark:text-white" />
                                                                </div>
                                                            </div>
                                                            <div className="flex gap-3 pt-2">
                                                                <button onClick={()=>handleUpdate(r.id)} className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg text-sm font-medium transition-colors">ÂÑ≤Â≠ò‰øÆÊîπ</button>
                                                                <button onClick={()=>setEditingId(null)} className="flex-1 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 py-2 rounded-lg text-sm font-medium transition-colors">ÂèñÊ∂à</button>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <div className="flex justify-between items-center">
                                                            <div className="flex items-center gap-4">
                                                                <div className={`w-1.5 h-10 rounded-full ${r.p >= 0 ? 'bg-emerald-500' : 'bg-rose-500'}`}></div>
                                                                <div>
                                                                    <p className="text-xs text-slate-400 font-medium mb-0.5">{r.displayDateTime}</p>
                                                                    <p className="text-lg font-bold text-slate-800 dark:text-white">${r.amount.toLocaleString()}</p>
                                                                    <div className="flex gap-2 mt-1">
                                                                        {parseFloat(r.deposit) > 0 && <span className="text-xs bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 px-2 py-0.5 rounded font-semibold">ÂÖ•Èáë ${r.deposit.toLocaleString()}</span>}
                                                                        {parseFloat(r.withdrawal) > 0 && <span className="text-xs bg-rose-100 dark:bg-rose-900/30 text-rose-700 dark:text-rose-400 px-2 py-0.5 rounded font-semibold">Âá∫Èáë ${r.withdrawal.toLocaleString()}</span>}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div className="text-right">
                                                                <p className={`text-sm font-bold ${r.p >= 0 ? 'text-emerald-600 dark:text-emerald-400' : 'text-rose-600 dark:text-rose-400'}`}>
                                                                    {r.p >= 0 ? '+' : ''}{Math.round(r.p).toLocaleString()}
                                                                </p>
                                                                <p className="text-xs text-slate-400 mb-2">({r.r.toFixed(1)}%)</p>
                                                                <button 
                                                                    onClick={async (e)=>{e.stopPropagation(); if(confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜÁ¥ÄÈåÑÂóéÔºüÊ≠§Âãï‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')){await supabase.from('records').delete().eq('id', r.id); fetchData();}}} 
                                                                    className="text-xs border border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400 hover:border-red-200 dark:hover:border-red-800 px-3 py-1.5 rounded-md transition-all"
                                                                >
                                                                    Âà™Èô§
                                                                </button>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* üí∞ Ë≥áÁî¢ÁÆ°ÁêÜ */}
                                {activeTab === 'assets' && (
                                    <div className="animate-in fade-in duration-300 space-y-6">
                                        {/* Á∏ΩË≥áÁî¢Âç°Áâá */}
                                        <div className="bg-slate-900 dark:bg-slate-800 text-white p-8 rounded-xl shadow-lg text-center relative overflow-hidden transition-colors">
                                            <div className="relative z-10">
                                                <p className="text-sm font-medium text-slate-400 uppercase tracking-wider mb-2">È†ê‰º∞Á∏ΩË≥áÁî¢ (Total Assets)</p>
                                                <h4 className="text-5xl font-bold tracking-tight mb-8">${totalAssets.toLocaleString()}</h4>
                                                <button onClick={handleSyncToLedger} className="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-bold shadow-lg transition-all transform active:scale-95">
                                                    <span>‚ö°Ô∏è</span> ÂêåÊ≠•ÂØ´ÂÖ•Â∏≥Êú¨
                                                </button>
                                            </div>
                                            <div className="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white opacity-5 rounded-full blur-3xl"></div>
                                        </div>

                                        {/* Ë≥áÁî¢Ê∏ÖÂñÆ */}
                                        <div className="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden transition-colors">
                                            <div className="p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-850">
                                                <h3 className="font-bold text-slate-700 dark:text-slate-200">Ë≥áÁî¢ÈÖçÁΩÆÊòéÁ¥∞</h3>
                                                <button onClick={addAssetRow} className="text-sm font-semibold text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 bg-blue-50 dark:bg-blue-900/30 hover:bg-blue-100 dark:hover:bg-blue-900/50 px-4 py-2 rounded-lg transition-colors">
                                                    + Êñ∞Â¢ûÈ†ÖÁõÆ
                                                </button>
                                            </div>
                                            <div className="divide-y divide-slate-100 dark:divide-slate-800">
                                                {assets.map((item, index) => (
                                                    <div key={item.id} className="p-4 flex flex-col md:flex-row gap-4 items-center hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                                                        <div className="flex-1 w-full">
                                                            <label className="block md:hidden text-xs text-slate-400 mb-1">ÂêçÁ®±</label>
                                                            <input type="text" placeholder="‰æãÂ¶ÇÔºöBinance" value={item.name} onChange={e=>updateAsset(item.id, 'name', e.target.value)} className="input-field w-full p-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-800 dark:text-white font-medium placeholder-slate-400" />
                                                        </div>
                                                        <div className="w-full md:w-1/3">
                                                            <label className="block md:hidden text-xs text-slate-400 mb-1">ÈáëÈ°ç (USD)</label>
                                                            <div className="relative">
                                                                <span className="absolute left-3 top-3 text-slate-400 text-sm">$</span>
                                                                <input type="number" placeholder="0.00" value={item.amount} onChange={e=>updateAsset(item.id, 'amount', e.target.value)} className="input-field w-full p-3 pl-7 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-800 dark:text-white font-bold placeholder-slate-500" />
                                                            </div>
                                                        </div>
                                                        <div className="w-full md:w-auto flex justify-end">
                                                            <button onClick={()=>removeAssetRow(item.id)} className="text-sm text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 px-4 py-3 rounded-lg transition-colors">
                                                                Âà™Èô§
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            <div className="p-4 bg-slate-50 dark:bg-slate-850 text-center border-t border-slate-100 dark:border-slate-800 transition-colors">
                                                <p className="text-xs text-slate-500 dark:text-slate-400">Á≥ªÁµ±ÊúÉËá™ÂãïË®òÊÜ∂Ê≠§Ê∏ÖÂñÆÔºå‰∏ãÊ¨°ÈñãÂïüÊôÇÂ∞á‰øùÊåÅÂéüÊ®£„ÄÇ</p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* üìà Áç≤Âà©ÂàÜÊûê */}
                                {activeTab === 'analysis' && (
                                    <div className="animate-in fade-in duration-300 space-y-6">
                                        <div className="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm transition-colors">
                                            <h3 className="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wide mb-4">ÁØ©ÈÅ∏ÂçÄÈñì</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-xs text-slate-400 mb-1">ÈñãÂßãÊó•Êúü</label>
                                                    <input type="date" value={filterRange.start} onChange={e=>setFilterRange({...filterRange, start:e.target.value})} className="input-field w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-800 dark:text-white font-medium" />
                                                </div>
                                                <div>
                                                    <label className="block text-xs text-slate-400 mb-1">ÁµêÊùüÊó•Êúü</label>
                                                    <input type="date" value={filterRange.end} onChange={e=>setFilterRange({...filterRange, end:e.target.value})} className="input-field w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-800 dark:text-white font-medium" />
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div className="md:col-span-2 bg-slate-900 dark:bg-slate-800 text-white p-8 rounded-xl shadow-lg text-center relative overflow-hidden transition-colors">
                                                <div className="relative z-10">
                                                    <p className="text-sm font-medium text-slate-400 uppercase tracking-wide mb-2">ÂçÄÈñìÊ∑®Áç≤Âà© (Net Profit)</p>
                                                    <h4 className={`text-4xl font-bold mb-2 ${analysisStats.profit >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>
                                                        {analysisStats.profit >= 0 ? '+' : ''}${Math.round(analysisStats.profit).toLocaleString()}
                                                    </h4>
                                                    <p className="text-sm text-slate-400">ÂçÄÈñìÂ†±ÈÖ¨Áéá (ROI): <span className="text-white font-bold">{analysisStats.roi.toFixed(2)}%</span></p>
                                                </div>
                                            </div>
                                            <div className="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm text-center transition-colors">
                                                <p className="text-xs text-slate-500 dark:text-slate-400 uppercase font-bold mb-2">ÂçÄÈñìÁ∏ΩÂÖ•Èáë</p>
                                                <h4 className="text-2xl font-bold text-emerald-600 dark:text-emerald-400">${analysisStats.totalDep.toLocaleString()}</h4>
                                            </div>
                                            <div className="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm text-center transition-colors">
                                                <p className="text-xs text-slate-500 dark:text-slate-400 uppercase font-bold mb-2">ÂçÄÈñìÁ∏ΩÂá∫Èáë</p>
                                                <h4 className="text-2xl font-bold text-rose-600 dark:text-rose-400">${analysisStats.totalWith.toLocaleString()}</h4>
                                            </div>
                                        </div>

                                        <div className="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm transition-colors">
                                            <h3 className="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wide mb-6">Ë≥áÁî¢Ë∂®Âã¢ÂàÜÊûê</h3>
                                            <div className="h-80 w-full">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    {AreaChart ? (
                                                        <AreaChart data={analysisData} margin={{top:10, right:10, left:-20, bottom:0}}>
                                                            <defs>
                                                                <linearGradient id="areaColor" x1="0" y1="0" x2="0" y2="1">
                                                                    <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.3}/>
                                                                    <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                                                                </linearGradient>
                                                            </defs>
                                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke={chartColors.grid} />
                                                            <XAxis dataKey="displayDate" axisLine={false} tickLine={false} tick={{fontSize:11, fill:chartColors.text}} minTickGap={40} />
                                                            <YAxis axisLine={false} tickLine={false} tick={{fontSize:11, fill:chartColors.text}} />
                                                            <Tooltip contentStyle={{backgroundColor:chartColors.tooltipBg, borderRadius:'8px', border:`1px solid ${chartColors.tooltipBorder}`, color: isDarkMode ? '#fff' : '#000'}} />
                                                            <Area name="ÈÇÑÂéüÂ∏ÇÂÄº" type="monotone" dataKey="ÈÇÑÂéü" stroke="#3b82f6" strokeWidth={3} fillOpacity={1} fill="url(#areaColor)" />
                                                        </AreaChart>
                                                    ) : null}
                                                </ResponsiveContainer>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </main>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>